#!/bin/bash

# Set Vulkan
echo Set Vulkan > /tmp/regataos-prime/vulkan-hybrid-graphics.txt

sudo /usr/share/regataos/gpu/prime/vulkan-hybrid-graphics start

sleep 3

# Run the application with the discrete GPU
FILE1=$1
echo ">> $FILE1 <<"

kmsg=$(grep -r regataos-dgpu "$FILE1")
echo $kmsg

if [[ $kmsg == *"regataos-dgpu"* ]]; then

	kmsg=$(echo $FILE1 | cut -d/ -f 5)

	kmsg2=$(grep -r '^Exec=' $kmsg | cut -d ' ' -f 2-)

	echo ">> $kmsg2 <<"

	kmsg3=$(echo $kmsg2 | tr -s ' ' | cut -d" " -f1)

	echo ">> $kmsg3 <<"

	regataos-dgpu $kmsg3

else

	kmsg=$(echo $FILE1 | cut -d/ -f 5)

	kmsg2=$(grep -r '^Exec=' $kmsg | cut -d= -f 2)

	echo ">> $kmsg2 <<"

	kmsg3=$(echo $kmsg2 | tr -s ' ' | cut -d" " -f1)

	echo ">> $kmsg3 <<"

	regataos-dgpu $kmsg3

fi

rm -f /tmp/regataos-prime/vulkan-hybrid-graphics.txt

sudo /usr/share/regataos/gpu/prime/vulkan-hybrid-graphics start
